<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>v 1.2.</title>
<style>
  html,body {
    margin:0; height:100%;
    display:flex; align-items:center; justify-content:center;
    background:#0f172a; color:#f8fafc;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  }
  button {
    font-size:1.2rem;
    padding:16px 28px;
    border:none;
    border-radius:12px;
    background:#06b6d4;
    color:#022c36;
    box-shadow:0 6px 16px rgba(0,0,0,0.4);
    touch-action:manipulation;
  }
  #status {
    position:absolute; bottom:20px; left:0; right:0;
    text-align:center; font-size:0.95rem; color:#94a3b8;
  }
</style>
</head>
<body>
  <button id="micBtn">Start Microphone</button>
  <div id="status"></div>

<script>
(() => {
  const btn = document.getElementById('micBtn');
  const status = document.getElementById('status');

  let audioContext = null;
  let micStream = null;
  let sourceNode = null;

  function setStatus(msg) { status.textContent = msg; }

  async function startMic() {
    try {
      // Create (or resume) AudioContext
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      if (audioContext.state === 'suspended') {
        await audioContext.resume();
      }

      // Ask for microphone access
      micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
      sourceNode = audioContext.createMediaStreamSource(micStream);

      // Connect microphone directly to system output
      sourceNode.connect(audioContext.destination);

      btn.textContent = 'Stop Microphone';
      setStatus('Microphone is streaming to your current output device.');
    } catch (err) {
      console.error(err);
      setStatus('Error accessing microphone: ' + err.message);
      btn.textContent = 'Start Microphone';
    }
  }

  function stopMic() {
    if (sourceNode) {
      try { sourceNode.disconnect(); } catch {}
      sourceNode = null;
    }
    if (micStream) {
      micStream.getTracks().forEach(t => t.stop());
      micStream = null;
    }
    if (audioContext) {
      audioContext.close();
      audioContext = null;
    }
    btn.textContent = 'Start Microphone';
    setStatus('Microphone stopped.');
  }

  btn.addEventListener('click', async () => {
    if (micStream) stopMic();
    else await startMic();
  });
})();
</script>
</body>
</html>